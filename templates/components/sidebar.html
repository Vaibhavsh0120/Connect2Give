{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    {% block head %}
        {# The head content will be provided by the child template #}
    {% endblock head %}

    {# --- ADDED: Toast Notification Styles --- #}
    <style>
        .toast-container {
            position: fixed;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            padding-top: 20px;
            pointer-events: none;
        }
        .toast {
            min-width: 280px;
            max-width: 90vw;
            padding: 14px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            animation: slideDown 0.3s ease-out;
            font-size: 14px;
            font-weight: 500;
            pointer-events: auto;
        }
        .toast.success { background-color: #10b981; color: white; }
        .toast.error { background-color: #ef4444; color: white; }
        .toast.warning { background-color: #f59e0b; color: white; }
        .toast.info { background-color: #3b82f6; color: white; }
        .toast-close { background: none; border: none; color: inherit; font-size: 20px; cursor: pointer; opacity: 0.8; padding: 0; line-height: 1; flex-shrink: 0; }
        .toast-close:hover { opacity: 1; }
        @keyframes slideDown { from { transform: translateY(-100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(0); opacity: 1; } to { transform: translateY(-100%); opacity: 0; } }
        .toast.hiding { animation: slideUp 0.3s ease-in forwards; }
        @media (max-width: 480px) {
            .toast-container { padding-top: 10px; }
            .toast { min-width: auto; width: calc(100vw - 20px); padding: 12px 16px; font-size: 13px; }
        }
    </style>
</head>
<body>
    {# --- ADDED: Toast Notification Container --- #}
    <div class="toast-container" id="toast-container"></div>

    {% block body %}
        <button class="mobile-sidebar-toggle" id="sidebar-toggle-btn" onclick="toggleSidebar()" aria-label="Toggle sidebar">
            ☰
        </button>
        
        <div class="sidebar-overlay" onclick="closeSidebar()"></div>
        
        <aside class="sidebar" id="dashboard-sidebar">
            <div>
                <div class="sidebar-header">
                    <h1>{% block sidebar_title %}Dashboard{% endblock %}</h1>
                    <p>{% block sidebar_subtitle %}Main Menu{% endblock %}</p>
                </div>
                
                <nav class="sidebar-nav">
                    {% block nav_links %}
                    {% endblock nav_links %}
                </nav>
            </div>
            <div class="sidebar-footer">
                <a href="{% url 'logout' %}" class="sidebar-logout-btn">Logout</a>
            </div>
        </aside>

        {# --- ADDED: Global Helper Scripts --- #}
        <script>
            // Global function to get CSRF token
            function getCookie(name) {
                let cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    const cookies = document.cookie.split(';');
                    for (let i = 0; i < cookies.length; i++) {
                        const cookie = cookies[i].trim();
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }
            
            // Global function to show toast notifications
            function showToast(message, type = 'success', duration = 1500) {
                const container = document.getElementById('toast-container');
                if (!container) return;
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                
                const messageSpan = document.createElement('span');
                messageSpan.textContent = message;
                
                const closeBtn = document.createElement('button');
                closeBtn.className = 'toast-close';
                closeBtn.innerHTML = '×';
                closeBtn.onclick = () => removeToast(toast);
                
                toast.appendChild(messageSpan);
                toast.appendChild(closeBtn);
                container.appendChild(toast);
                
                setTimeout(() => removeToast(toast), duration);
            }
            
            function removeToast(toast) {
                toast.classList.add('hiding');
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }
        </script>

        <script>
            // Mobile sidebar toggle functionality
            function toggleSidebar() {
                const sidebar = document.getElementById('dashboard-sidebar');
                const overlay = document.querySelector('.sidebar-overlay');
                const toggleBtn = document.getElementById('sidebar-toggle-btn');
                sidebar.classList.toggle('open');
                overlay.classList.toggle('active');
                if (toggleBtn) {
                    toggleBtn.style.display = 'none'; // Hide button when sidebar is open
                }
            }

            function closeSidebar() {
                const sidebar = document.getElementById('dashboard-sidebar');
                const overlay = document.querySelector('.sidebar-overlay');
                const toggleBtn = document.getElementById('sidebar-toggle-btn');
                sidebar.classList.remove('open');
                overlay.classList.remove('active');
                if (toggleBtn) {
                    toggleBtn.style.display = 'block'; // Show button when sidebar is closed
                }
            }

            // Close sidebar when clicking on a nav link on mobile
            document.addEventListener('DOMContentLoaded', function() {
                const navLinks = document.querySelectorAll('.nav-link');
                navLinks.forEach(link => {
                    link.addEventListener('click', function() {
                        if (window.innerWidth <= 768) {
                            closeSidebar();
                        }
                    });
                });

                // Swipeable sidebar functionality
                const sidebar = document.getElementById('dashboard-sidebar');
                const overlay = document.querySelector('.sidebar-overlay');
                let touchStartX = 0;
                let touchCurrentX = 0;
                let touchStartY = 0;
                let touchCurrentY = 0;
                let isSwiping = false;
                const swipeThreshold = 50; // Minimum distance for a swipe
                const edgeThreshold = 30; // Distance from left edge to start swipe

                // Touch start handler
                document.addEventListener('touchstart', function(e) {
                    touchStartX = e.touches[0].clientX;
                    touchStartY = e.touches[0].clientY;
                    
                    // Check if swipe starts from left edge to open sidebar
                    if (touchStartX < edgeThreshold && !sidebar.classList.contains('open')) {
                        isSwiping = true;
                    }
                    
                    // Check if swipe starts on sidebar to close it
                    if (sidebar.classList.contains('open')) {
                        const sidebarRect = sidebar.getBoundingClientRect();
                        if (touchStartX >= sidebarRect.left && touchStartX <= sidebarRect.right) {
                            isSwiping = true;
                        }
                    }
                }, { passive: true });

                // Touch move handler
                document.addEventListener('touchmove', function(e) {
                    if (!isSwiping) return;
                    
                    touchCurrentX = e.touches[0].clientX;
                    touchCurrentY = e.touches[0].clientY;
                    
                    const deltaX = touchCurrentX - touchStartX;
                    const deltaY = touchCurrentY - touchStartY;
                    
                    // Only handle horizontal swipes (not vertical scrolling)
                    if (Math.abs(deltaX) > Math.abs(deltaY)) {
                        // Prevent vertical scrolling during horizontal swipe
                        if (Math.abs(deltaX) > 10) {
                            e.preventDefault();
                        }
                    }
                }, { passive: false });

                // Touch end handler
                document.addEventListener('touchend', function(e) {
                    if (!isSwiping) return;
                    
                    const deltaX = touchCurrentX - touchStartX;
                    const deltaY = touchCurrentY - touchStartY;
                    
                    // Only handle horizontal swipes
                    if (Math.abs(deltaX) > Math.abs(deltaY)) {
                        // Swipe right to open (from left edge)
                        if (deltaX > swipeThreshold && !sidebar.classList.contains('open')) {
                            toggleSidebar();
                        }
                        // Swipe left to close (when sidebar is open)
                        else if (deltaX < -swipeThreshold && sidebar.classList.contains('open')) {
                            closeSidebar();
                        }
                    }
                    
                    isSwiping = false;
                    touchStartX = 0;
                    touchCurrentX = 0;
                    touchStartY = 0;
                    touchCurrentY = 0;
                }, { passive: true });
            });
        </script>
    {% endblock body %}
</body>
</html>
